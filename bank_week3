create database bank;
use bank;

create table branch (
branch_name char(20) primary key,
branch_city char(15),
assets int
);

create table bankAccount (
accno int,
branch_name char (20),
balance int,
primary key (accno, branch_name),
foreign key (branch_name) references branch(branch_name)
);

create table bankCustomer (
customer_name char (15) primary key,
customer_street char (20),
city char (10) 
);

create table depositor (
customer_name char (15),
accno int,
primary key (customer_name, accno),
foreign key (customer_name) references bankCustomer(customer_name),
foreign key (accno) references bankAccount(accno)
);

create table loan (
loan_number int,
branch_name char (20),
amount int,
primary key (loan_number, branch_name),
foreign key (branch_name) references branch(branch_name)
);

insert into branch values('SBI_Chamrajpet','Bangalore',50000),
('SBI_ResidencyRoad','Bangalore',10000),
('SBI_ShivajiRoad','Bombay',20000),
('SBI_ParliamentRoad','Delhi',10000),
('SBI_Jantarmantar','Delhi',20000);

insert into bankAccount values (1,'SBI_Chamrajpet',2000),
(2,'SBI_ResidencyRoad',5000),
(3,'SBI_ShivajiRoad',6000),
(4,'SBI_ParliamentRoad',9000),
(5,'SBI_Jantarmantar',8000),
(6,'SBI_ShivajiRoad',4000),
(8,'SBI_ResidencyRoad',4000),
(9,'SBI_ParliamentRoad',3000),
(10,'SBI_ResidencyRoad',5000),
(11,'SBI_Jantarmantar',2000);

insert into bankCustomer values ('Avinash','Bull_Temple_Road','Bangalore'),
('Dinesh','Bannergatta_Road','Bangalore'),
('Mohan','NationalCollege_Road','Bangalore'),
('Nikil','Akbar_Road','Delhi'),
('Ravi','Prithviraj_Road','Delhi');

insert into depositor values ('Avinash',1),
('Dinesh',2),
('Nikil',4),
('Ravi',5),
('Avinash',8),
('Nikil',9),
('Dinesh',10),
('Nikil',11);

insert into loan values (1,'SBI_Chamrajpet',1000),
(2,'SBI_ResidencyRoad',2000),
(3,'SBI_ShivajiRoad',3000),
(4,'SBI_ParliamentRoad',4000),
(5,'SBI_Jantarmantar',5000);
/*view of assets of bank*/
create view bank_assets (bank_name, assets_in_lakhs) as select branch_name, assets/100000 from branch;
select * frp, bank-assets;

create view loans(branch, loans) 
as select b.branch_name, sum(l.amount) from branch b, loan l where b.branch_name=l.branch_name 
group by branch_name;

/*Find customer who has 2 accounts in one branch*/
select customer_name from depositor where accno in 
(select accno from bankAccount where branch_name like '%Resi%') 
group by customer_name having count(customer_name)>=2;

/*View of loans from each branch*/
create view a_loans(Branch_name,Amount)
as select branch_name,sum(amount) from loan 
group by branch_name;
select * from loans;

select CONCAT(Balance+1000,'  rupees') UPDATED_BALANCE from bankAccount b, bankCustomer bc, depositor d 
where bc.Customer_name=d.Customer_name and b.Accno=d.Accno and bc.city='Bangalore';


